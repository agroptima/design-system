"use strict";(self.webpackChunkagroptima_design_system=self.webpackChunkagroptima_design_system||[]).push([[6651],{"./src/atoms/Select/InfiniteSelect.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{j:()=>InfiniteSelect});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),react=(__webpack_require__("./src/atoms/Select/Select.scss"),__webpack_require__("./node_modules/next/dist/compiled/react/index.js"));function c(e,u,c,i){var a=this,o=(0,react.useRef)(null),f=(0,react.useRef)(0),l=(0,react.useRef)(0),v=(0,react.useRef)(null),m=(0,react.useRef)([]),d=(0,react.useRef)(),g=(0,react.useRef)(),p=(0,react.useRef)(e),w=(0,react.useRef)(!0);p.current=e;var s="undefined"!=typeof window,x=!u&&0!==u&&s;if("function"!=typeof e)throw new TypeError("Expected a function");u=+u||0;var h=!!(c=c||{}).leading,y=!("trailing"in c)||!!c.trailing,F="maxWait"in c,A="debounceOnServer"in c&&!!c.debounceOnServer,D=F?Math.max(+c.maxWait||0,u):null;(0,react.useEffect)((function(){return w.current=!0,function(){w.current=!1}}),[]);var T=(0,react.useMemo)((function(){var r=function(r){var n=m.current,t=d.current;return m.current=d.current=null,f.current=r,l.current=l.current||r,g.current=p.current.apply(t,n)},n=function(r,n){x&&cancelAnimationFrame(v.current),v.current=x?requestAnimationFrame(r):setTimeout(r,n)},t=function(r){if(!w.current)return!1;var n=r-o.current;return!o.current||n>=u||n<0||F&&r-f.current>=D},e=function(n){return v.current=null,y&&m.current?r(n):(m.current=d.current=null,g.current)},c=function r(){var c=Date.now();if(h&&l.current===f.current&&T(),t(c))return e(c);if(w.current){var i=u-(c-o.current),a=F?Math.min(i,D-(c-f.current)):i;n(r,a)}},T=function(){i&&i({})},W=function(){if(s||A){var e=Date.now(),i=t(e);if(m.current=[].slice.call(arguments),d.current=a,o.current=e,i){if(!v.current&&w.current)return f.current=o.current,n(c,u),h?r(o.current):g.current;if(F)return n(c,u),r(o.current)}return v.current||n(c,u),g.current}};return W.cancel=function(){v.current&&(x?cancelAnimationFrame(v.current):clearTimeout(v.current)),f.current=0,m.current=o.current=d.current=v.current=null},W.isPending=function(){return!!v.current},W.flush=function(){return v.current?e(Date.now()):g.current},W}),[h,F,u,D,y,x,s,A,i]);return T}var useOpen=__webpack_require__("./src/hooks/useOpen.ts"),useOutsideClick=__webpack_require__("./src/hooks/useOutsideClick.ts"),classNames=__webpack_require__("./src/utils/classNames.ts"),Icon=__webpack_require__("./src/atoms/Icon.tsx"),Input=__webpack_require__("./src/atoms/Input.tsx"),SelectItem=__webpack_require__("./src/atoms/Select/SelectItem.tsx"),SelectTrigger=__webpack_require__("./src/atoms/Select/SelectTrigger.tsx"),BaseSelect=__webpack_require__("./src/atoms/Select/BaseSelect.tsx"),console=__webpack_require__("./node_modules/console-browserify/index.js");const MIN_LENGTH_SEARCH=2,SEARCH_DEBOUNCE_TIME=500;function InfiniteSelect({id,name,label,placeholder,searchLabel,accessibilityLabel,className,defaultValue,disabled=!1,helpText,searchDebounceTime=SEARCH_DEBOUNCE_TIME,minLengthSearch=MIN_LENGTH_SEARCH,displayItem,query,errors,fullWidth=!1,...props}){const{isOpen,close,toggle}=(0,useOpen.i)(),selectRef=(0,react.useRef)(null),loaderRef=(0,react.useRef)(null);(0,useOutsideClick.j)(selectRef,close);const[selectedItem,setSelectedItem]=(0,react.useState)(defaultValue||null),[items,setItems]=(0,react.useState)([]),[page,setPage]=(0,react.useState)(1),[morePages,setMorePages]=(0,react.useState)(!0),[loading,setLoading]=(0,react.useState)(!1),buttonRef=(0,react.useRef)(null),identifier=id||name,displayValue=selectedItem?displayItem(selectedItem):placeholder,isInvalid=Boolean(null==errors?void 0:errors.length),selectTriggerRef=(0,react.useRef)(null);(0,useOutsideClick.j)(selectRef,(()=>{var _selectTriggerRef_current;isOpen&&(close(),null==selectTriggerRef||null===(_selectTriggerRef_current=selectTriggerRef.current)||void 0===_selectTriggerRef_current||_selectTriggerRef_current.focus())}));const loadItems=(0,react.useCallback)((async(searchTerm="",resetPage)=>{if(!loading&&morePages){setLoading(!0);try{const currentPage=resetPage||page,{items,totalPages}=await query({page:currentPage.toString(),search:searchTerm});setItems((prev=>[...prev,...items])),setPage(currentPage+1),setMorePages(currentPage<totalPages)}catch(error){console.error("Error loading items:",error)}setLoading(!1)}}),[page,query,loading,morePages]);(0,react.useEffect)((()=>{const observer=new IntersectionObserver((([entry])=>{entry.isIntersecting&&loaderRef.current&&loadItems()}),{rootMargin:"0px"}),loader=loaderRef.current;return loader&&observer.observe(loader),()=>{loader&&observer.unobserve(loader),observer.disconnect()}}),[loadItems,loaderRef,loading]);const sendSearchTerm=c((term=>{term.length>0&&term.length<minLengthSearch||(setPage(1),setItems([]),setMorePages(!0),loadItems(term,1))}),searchDebounceTime);return(0,jsx_runtime.jsxs)(BaseSelect.g,{placeholder,label,isEmpty:!(null==selectedItem?void 0:selectedItem.uid),errors,selectRef,identifier,helpText,className,...props,children:[(0,jsx_runtime.jsx)(SelectTrigger.b,{id:identifier,label,isOpen,isEmpty:!(null==selectedItem?void 0:selectedItem.uid),invalid:isInvalid,accessibilityLabel,onClick:toggle,onClear:()=>{setSelectedItem(null)},buttonRef,disabled,children:displayValue}),(0,jsx_runtime.jsx)("input",{type:"hidden",name,value:(null==selectedItem?void 0:selectedItem.uid)||"",...props}),(0,jsx_runtime.jsx)("div",{className:(0,classNames.x)("select-options-container",{hidden:!isOpen}),children:(0,jsx_runtime.jsxs)("div",{className:"select-options",children:[(0,jsx_runtime.jsx)(Input.p,{autoFocus:!0,label:searchLabel,hideLabel:!0,onChange:e=>{return searchTerm=e.target.value,void sendSearchTerm(searchTerm);var searchTerm},placeholder:searchLabel,icon:"Search",className:"search"}),(0,jsx_runtime.jsxs)("ul",{role:"listbox",children:[items.map((item=>(0,jsx_runtime.jsx)(SelectItem.e,{multiple:!1,label:displayItem(item),isSelected:(null==selectedItem?void 0:selectedItem.uid)===item.uid,onSelectOption:()=>(item=>{setSelectedItem(item),close()})(item),onClose:close},item.uid))),(0,jsx_runtime.jsx)(LoadingItems,{label:"Loading items",visible:morePages,loaderRef})]})]})})]})}function LoadingItems({label,visible,loaderRef}){return visible?(0,jsx_runtime.jsx)("li",{children:(0,jsx_runtime.jsx)("div",{ref:loaderRef,"aria-label":label,className:"loading",children:(0,jsx_runtime.jsx)(Icon.I,{name:"Loading"})})}):null}try{InfiniteSelect.displayName="InfiniteSelect",InfiniteSelect.__docgenInfo={description:"",displayName:"InfiniteSelect",props:{id:{defaultValue:null,description:"",name:"id",required:!1,type:{name:"string"}},name:{defaultValue:null,description:"",name:"name",required:!1,type:{name:"string"}},label:{defaultValue:null,description:"",name:"label",required:!0,type:{name:"string"}},placeholder:{defaultValue:null,description:"",name:"placeholder",required:!0,type:{name:"string"}},accessibilityLabel:{defaultValue:null,description:"",name:"accessibilityLabel",required:!1,type:{name:"string"}},searchLabel:{defaultValue:null,description:"",name:"searchLabel",required:!0,type:{name:"string"}},defaultValue:{defaultValue:null,description:"",name:"defaultValue",required:!1,type:{name:"{ uid: string; }"}},searchDebounceTime:{defaultValue:{value:"500"},description:"",name:"searchDebounceTime",required:!1,type:{name:"number"}},disabled:{defaultValue:{value:"false"},description:"",name:"disabled",required:!1,type:{name:"boolean"}},helpText:{defaultValue:null,description:"",name:"helpText",required:!1,type:{name:"string"}},minLengthSearch:{defaultValue:{value:"2"},description:"",name:"minLengthSearch",required:!1,type:{name:"number"}},displayItem:{defaultValue:null,description:"",name:"displayItem",required:!0,type:{name:"(item: T) => string"}},query:{defaultValue:null,description:"",name:"query",required:!0,type:{name:"(payload: Payload) => Promise<{ items: T[]; totalPages: number; }>"}},errors:{defaultValue:null,description:"",name:"errors",required:!1,type:{name:"string[]"}},fullWidth:{defaultValue:{value:"false"},description:"",name:"fullWidth",required:!1,type:{name:"boolean"}},className:{defaultValue:null,description:"",name:"className",required:!1,type:{name:"string"}},variant:{defaultValue:null,description:"",name:"variant",required:!1,type:{name:"enum",value:[{value:'"primary"'}]}},required:{defaultValue:null,description:"",name:"required",required:!1,type:{name:"boolean"}},hideLabel:{defaultValue:null,description:"",name:"hideLabel",required:!1,type:{name:"boolean"}},identifier:{defaultValue:null,description:"",name:"identifier",required:!1,type:{name:"string"}},selectRef:{defaultValue:null,description:"",name:"selectRef",required:!1,type:{name:"RefObject<HTMLDivElement | null>"}}}},"undefined"!=typeof STORYBOOK_REACT_CLASSES&&(STORYBOOK_REACT_CLASSES["src/atoms/Select/InfiniteSelect.tsx#InfiniteSelect"]={docgenInfo:InfiniteSelect.__docgenInfo,name:"InfiniteSelect",path:"src/atoms/Select/InfiniteSelect.tsx#InfiniteSelect"})}catch(__react_docgen_typescript_loader_error){}},"./src/stories/InfiniteSelect.stories.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Primary:()=>Primary,PrimaryWithSelectedOptions:()=>PrimaryWithSelectedOptions,__namedExportsOrder:()=>__namedExportsOrder,default:()=>__WEBPACK_DEFAULT_EXPORT__});const fakeQuery=async({page="1",search})=>{const pages={1:[{uid:"1",name:"Nintendo Switch"},{uid:"2",name:"PlayStation 5"},{uid:"3",name:"Xbox Series S/X"},{uid:"4",name:"PC"},{uid:"5",name:"Mobile"},{uid:"6",name:"VR Headset"},{uid:"7",name:"Retro Console"},{uid:"8",name:"Handheld Console"},{uid:"9",name:"Arcade Machine"},{uid:"10",name:"Streaming Device"}],2:[{uid:"11",name:"Gaming Laptop"},{uid:"12",name:"Smart TV"},{uid:"13",name:"Tablet"},{uid:"14",name:"Smartphone"},{uid:"15",name:"Cloud Gaming Service"},{uid:"16",name:"Emulator"},{uid:"17",name:"Gaming Monitor"},{uid:"18",name:"Gaming Chair"},{uid:"19",name:"Gaming Headset"},{uid:"20",name:"Gaming Keyboard"}]};return new Promise((resolve=>{setTimeout((()=>{resolve({items:pages[page]||[],totalPages:2})}),1e3)}))},figmaPrimaryDesign={design:{type:"figma",url:"https://www.figma.com/file/DN2ova21vWqCRvPspBXgI1/Design-System?type=design&node-id=188-1956&mode=dev"}},__WEBPACK_DEFAULT_EXPORT__={title:"Design System/Atoms/InfiniteSelect",component:__webpack_require__("./src/atoms/Select/InfiniteSelect.tsx").j,parameters:{docs:{description:{component:"<h2>Usage guidelines</h2><p>Use the infinite select component within a form where users select from a list that loads the data as they scroll, select and option and submit the data.</p><ul> <li>Include a label</li> <li>Include a placeholder</li> <li>Keep menu items concise</li> <li>Mark the minority of pickers in a form as required or optional</li> <li>Use help text to show context</li> <li>Switch help text with error text</li> <li>Write error text that shows a solution</li> <li>Include a search input</li></ul>"}}},tags:["autodocs"],argTypes:{id:{description:"Set id property"},name:{description:"Set name property"},label:{description:"Label for the infinite select"},placeholder:{description:"Set select placeholder text"},searchLabel:{description:"Label for the search input"},helpText:{description:"Optional help text"},required:{description:"Is required?",type:"boolean"},disabled:{description:"Is the select in disabled state?"},variant:{description:"Component variant used"},className:{description:"Additional class names to apply to the component"},defaultValue:{description:"Value to be displayed as selected"},displayItem:{description:"Function to display the item in the select"},query:{description:"Function to query the items",table:{type:{summary:"(payload: Payload) => Promise<{ items: T[]; totalPages: number }>"}}}}},Primary={args:{id:"select-videogames",name:"example",helpText:"This text can help you",label:"Videogames",placeholder:"Select your favourite gaming system...",searchLabel:"Search videogames",disabled:!1,required:!0,displayItem:item=>item.name||"",query:fakeQuery},parameters:figmaPrimaryDesign},PrimaryWithSelectedOptions={args:{id:"select-videogames",name:"example",helpText:"This text can help you",label:"Videogames",placeholder:"Select your favourite gaming system...",searchLabel:"Search videogames",disabled:!1,required:!0,defaultValue:{uid:"1",name:"Nintendo Switch"},displayItem:item=>item.name||"",query:fakeQuery},parameters:figmaPrimaryDesign},__namedExportsOrder=["Primary","PrimaryWithSelectedOptions"];Primary.parameters={...Primary.parameters,docs:{...Primary.parameters?.docs,source:{originalSource:"{\n  args: {\n    id: 'select-videogames',\n    name: 'example',\n    helpText: 'This text can help you',\n    label: 'Videogames',\n    placeholder: 'Select your favourite gaming system...',\n    searchLabel: 'Search videogames',\n    disabled: false,\n    required: true,\n    displayItem: (item: {\n      uid: string;\n      name?: string;\n    }) => {\n      return item.name || '';\n    },\n    query: fakeQuery\n  },\n  parameters: figmaPrimaryDesign\n}",...Primary.parameters?.docs?.source}}},PrimaryWithSelectedOptions.parameters={...PrimaryWithSelectedOptions.parameters,docs:{...PrimaryWithSelectedOptions.parameters?.docs,source:{originalSource:"{\n  args: {\n    id: 'select-videogames',\n    name: 'example',\n    helpText: 'This text can help you',\n    label: 'Videogames',\n    placeholder: 'Select your favourite gaming system...',\n    searchLabel: 'Search videogames',\n    disabled: false,\n    required: true,\n    defaultValue: {\n      uid: '1',\n      name: 'Nintendo Switch'\n    } as Item,\n    displayItem: (item: {\n      uid: string;\n      name?: string;\n    }) => {\n      return item.name || '';\n    },\n    query: fakeQuery\n  },\n  parameters: figmaPrimaryDesign\n}",...PrimaryWithSelectedOptions.parameters?.docs?.source}}}}}]);